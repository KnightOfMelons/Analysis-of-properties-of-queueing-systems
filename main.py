from math import factorial
import matplotlib.pyplot as plt
import numpy as np

def calculate_p0(y, n, M):
    series = sum(y ** i / factorial(i) for i in range(n + 1))
    corr = y ** (n + 1) * (1 - (y / n) ** M) / (factorial(n) * n * (1 - y / n))
    return (series + corr) ** -1

def calculate_pi(y, n, M, p0):
    return y ** (n + M) * p0 / (n ** M * factorial(n))

def calculate_l(y, n, M, p0):
    numerator = y ** (n + 1) * (1 - (y / n) ** M * (M + 1 - M / n * y)) * p0
    divider = factorial(n) * n * (1 - y / n) ** 2
    return numerator / divider


while True:
      choose = int(input("\n1 - –ü–µ—Ä–≤–∞—è –∑–∞–¥–∞—á–∞,\n2 - –í—Ç–æ—Ä–∞—è –∑–∞–¥–∞—á–∞,\n0 - –í—ã–π—Ç–∏ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã.\n–í–∞—à –≤—ã–±–æ—Ä: "))

      if choose == 1:
            # 2. –í –ø–æ—Ä—Ç—É –∏–º–µ–µ—Ç—Å—è –æ–¥–∏–Ω –ø—Ä–∏—á–∞–ª –¥–ª—è —Ä–∞–∑–≥—Ä—É–∑–∫–∏ —Å—É–¥–æ–≤. –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–∞ —Å—É–¥–æ–≤ —Ä–∞–≤–Ω–∞ 0.4 —Å—É–¥–æ–≤ –≤ 1 —Å—É—Ç. –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è
            # —Ä–∞–∑–≥—Ä—É–∑–∫–∏ –æ–¥–Ω–æ–≥–æ —Å—É–¥–Ω–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 2 —Å—É—Ç. –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –æ—á–µ—Ä–µ–¥—å –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã. –ù–∞–π—Ç–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
            # —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏—á–∞–ª–∞, –∞ —Ç–∞–∫–∂–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ç–æ–≥–æ, —á—Ç–æ –æ–∂–∏–¥–∞—é—Ç —Ä–∞–∑–≥—Ä—É–∑–∫–∏ –Ω–µ –±–æ–ª–µ–µ —á–µ–º 2 —Å—É–¥–Ω–∞.
            # –û—Ç–≤–µ—Ç: p–æ = 0.2, p1,2,3 = 0.3904, l = 3.2, w = 8 —Å—É—Ç, m = 4, u = 10 —Å—É—Ç.

            lambd = 0.4
            u = 1 / 2

            y = lambd / u

            p0 = (1 - y)
            p_zan = 1 - p0

            p1 = y ** 1 * (1 - y)
            p2 = y ** 2 * (1 - y)
            p3 = y ** 3 * (1 - y)

            P_k_leq_3 = p1 + p2 + p3

            m = y / (1 - y)
            u = m / lambd

            l = y ** 2 / (1 - y)
            w = l / lambd

            print(f"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ—Å—Ç–æ—è (p0): {round(p0, 1)}\n"
                  f"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ç–æ–≥–æ, —á—Ç–æ –≤ –æ—á–µ—Ä–µ–¥–∏ –Ω–µ –±–æ–ª–µ–µ 3 —Å—É–¥–æ–≤ (P1 + P2 + P3): {P_k_leq_3:.4f}\n"
                  f"–°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ —Å—É–¥–æ–≤ –≤ –æ—á–µ—Ä–µ–¥–∏ (l): {round(l, 1)}\n"
                  f"–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏ (w): {round(w)} —Å—É—Ç–æ–∫\n"
                  f"–°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ —Å—É–¥–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ (m): {round(m, 1)}\n"
                  f"–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è —Å—É–¥–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ (u): {round(u, 1)} —Å—É—Ç–æ–∫")

      elif choose == 2:
            # 2. –í –ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–æ–π —Ä–∞–±–æ—Ç–∞—é—Ç 3 –º–∞—Å—Ç–µ—Ä–∞, –∞ –≤ –∑–∞–ª–µ –æ–∂–∏–¥–∞–Ω–∏—è
            # —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã 3 —Å—Ç—É–ª–∞. –ü–æ—Ç–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–º–µ–µ—Ç –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å
            # Œª = 12 –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ 1 —á. –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è b = 20 –º–∏–Ω.
            # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—É—é –∏ –∞–±—Å–æ–ª—é—Ç–Ω—É—é –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã, —Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –∑–∞–Ω—è—Ç—ã—Ö –∫—Ä–µ—Å–µ–ª, —Å—Ä–µ–¥–Ω—é—é –¥–ª–∏–Ω—É
            # –æ—á–µ—Ä–µ–¥–∏, —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è, –∫–æ—Ç–æ—Ä–æ–µ –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç –≤ –ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–æ–π.
            # –û—Ç–≤–µ—Ç: —Ä0 = 0,012, œÄ = 0,307, Q = 0,693, Œª‚Ä≤ = 8,32, –∑–∞–Ω k = 2,78,
            # l = 1,76, w = 0,13 —á, m = 4,34, u = 0,36 —á.

            n, M = 3, 3  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Å—Ç–µ—Ä–æ–≤ –∏ –∫—Ä–µ—Å–µ–ª
            lambd, u = 12, 3  # –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –≤—Ä–µ–º—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è

            Œª_range, Œº_range = np.meshgrid(np.linspace(0.1, 10, 50), np.linspace(0.1, 10, 50))

            y = Œª_range / Œº_range

            p0 = calculate_p0(y, n, M)
            pi = calculate_pi(y, n, M, p0)
            Q = 1 - pi
            lambd_ = Œª_range * Q
            k_zan = lambd_ / Œº_range
            l = calculate_l(y, n, M, p0)
            w = l / Œª_range
            m = l + k_zan
            u = m / Œª_range

            print(f'\n–ó–Ω–∞—á–µ–Ω–∏—è p0 = {np.mean(p0):.3f},'
                  f' ùúã = {np.mean(pi):.3f},'
                  f' Q = {np.mean(Q):.3f},'
                  f' Œª\' = {np.mean(lambd_):.2f},'
                  f' k_–∑–∞–Ω = {np.mean(k_zan):.2f},'
                  f' l = {np.mean(l):.2f},'
                  f' w = {np.mean(w):.2f},'
                  f' m = {np.mean(m):.2f},'
                  f' u = {np.mean(u):.2f}\n')

            parameters = {
                  'p0 (–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤)': p0,
                  'œÄ (–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Ç–∫–∞–∑–∞ –≤ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏)': pi,
                  'Q (–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å)': Q,
                  'Œª\' (–ê–±—Å–æ–ª—é—Ç–Ω–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å)': lambd_,
                  'k_–∑–∞–Ω (–°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –∑–∞–Ω—è—Ç—ã—Ö –∫–∞–Ω–∞–ª–æ–≤)': k_zan,
                  'l (–°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –∑–∞—è–≤–æ–∫ –≤ –æ—á–µ—Ä–µ–¥–∏)': l,
                  'w (–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è)': w,
                  'm (–°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –∑–∞—è–≤–æ–∫ –≤ —Å–∏—Å—Ç–µ–º–µ)': m,
                  'u (–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ –≤ —Å–∏—Å—Ç–µ–º–µ)': u
            }

            for name, value in parameters.items():
                  fig = plt.figure(figsize=(12, 8))
                  ax = fig.add_subplot(111, projection='3d')
                  surf = ax.plot_surface(Œª_range, Œº_range, value, cmap='viridis', edgecolor='none')
                  ax.set_title(name)
                  ax.set_xlabel('Œª (–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤)')
                  ax.set_ylabel('Œº (–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è)')
                  ax.set_zlabel(name)
                  fig.colorbar(surf, ax=ax)
                  plt.show()
                  plt.close(fig)

      elif choose == 0:
            print("–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã")
            break
      else:
            continue